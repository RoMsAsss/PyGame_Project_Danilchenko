{% extends "base.html" %}

{% block content %}
<div class="notes-container">
    <header class="notes-header">
        <div class="header-title">
            <i class="fas fa-book"></i>
            <h1>–î–Ω–µ–≤–Ω–∏–∫</h1>
        </div>
        <button class="back-btn" onclick="window.location.href='{{ url_for('index') }}'">
            <i class="fas fa-arrow-left"></i>
            –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </button>
    </header>

    <div class="notes-controls">
        <button class="add-note-btn" data-bs-toggle="modal" data-bs-target="#addDiaryModal">
            <i class="fas fa-plus"></i>
            –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å
        </button>
    </div>

    <div class="notes-grid">
        {% for entry in entries %}
        <div class="note-card" onclick="window.location.href='{{ url_for('view_diary_entry', id=entry.id) }}'">
            <h3>{{ entry.title }}</h3>
            <p>{{ entry.content[:100] }}{% if entry.content|length > 100 %}...{% endif %}</p>
            <div class="note-date">
                <i class="far fa-calendar-alt"></i>
                <span>{{ entry.date.strftime('%d.%m.%Y') }}</span>
                {% if entry.mood %}<span class="mood-badge">{{ entry.mood }}</span>{% endif %}
            </div>
            <div class="note-actions">
                <button class="note-action-btn" title="–£–¥–∞–ª–∏—Ç—å"
                        onclick="event.stopPropagation(); if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                            fetch('{{ url_for('delete_diary_entry', id=entry.id) }}', {
                                method: 'POST',
                            }).then(() => window.location.reload());
                        }">
                    <i class="far fa-trash-alt"></i>
                </button>
            </div>
            <div class="hover-effect"></div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
<div class="modal fade" id="addDiaryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_diary_entry') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–î–∞—Ç–∞</label>
                        <input type="date" name="date" class="form-control"
                               value="{{ current_date }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <input type="text" name="title" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
                        <select name="mood" class="form-select">
                            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                            <option value="üòä –•–æ—Ä–æ—à–µ–µ">üòä –•–æ—Ä–æ—à–µ–µ</option>
                            <option value="üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ">üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ</option>
                            <option value="üòû –ü–ª–æ—Ö–æ–µ">üòû –ü–ª–æ—Ö–æ–µ</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                        <textarea name="content" class="form-control" rows="5" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}